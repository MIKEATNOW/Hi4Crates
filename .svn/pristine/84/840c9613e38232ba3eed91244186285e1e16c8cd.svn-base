<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.IPhysicalMapper">

	<resultMap type="memberVO" id="orderMap">
		<id property="orderCode" column="order_code"/>
		<id property="bodyCode" column="body_code"/>
		<id property="chartDate" column="chart_date"/>
		<id property="chartRecord" column="chart_record"/>
		<id property="memName" column="mem_name"/>
		<id property="memGender" column="mem_gender"/>
		<id property="memAge" column="mem_age"/>
		<id property="docName" column="emp_name"/>
	</resultMap>
	
	<resultMap type="memberVO" id="waitingListMap">
		<id property="chartNo" column="chart_no"/>
		<result property="memNo" column="mem_no"/>
		<result property="memName" column="mem_name"/>
		<result property="memAge" column="mem_age"/>
		<result property="memGender" column="mem_gender"/>
		<result property="receiptNo" column="receipt_no"/>
		<result property="codeName" column="code_name"/>
		<result property="historyLoc" column="history_loc"/>
		<result property="historyStatus" column="history_status"/>
		<collection property="orderList" resultMap="orderListMap"/>
	</resultMap>
	
	<resultMap type="orderVO" id="orderListMap">
		<id property="orderNo" column="order_no"/>
		<result property="chartNo" column="chart_no"/>
		<result property="orderCode" column="order_code"/>
		<result property="bodyCode" column="body_code"/>
		<result property="docName" column="emp_no"/>
	</resultMap>
	
	
	<select id="selectPhysicalWaitingList" resultMap="waitingListMap">
		SELECT
				m.mem_no
			, m.mem_name
			, m.mem_age
			, m.mem_gender
			, o.order_no
			, o.order_code
			, o.body_code
			, o.chart_no
			, h.history_date
			, h.history_loc
			, h.history_status
			, h.receipt_no
			, ch.patnt_no
			, ch.receipt_no
		FROM
				member		m
			, patient	 p
			, "HISTORY" h
			, chart		 ch
			, "ORDER"	 o
			, "RECEIPT" r
		WHERE
				( h.history_loc = 'LOC008'
					OR h.history_loc = 'LOC009' )
				AND ( h.history_status = 'HS001'
							OR h.history_status = 'HS003' )
				AND p.patnt_no = ch.patnt_no
				AND p.patnt_no = r.patnt_no
				AND o.chart_no = ch.chart_no
				AND p.mem_no = m.mem_no
				AND h.receipt_no = r.receipt_no
		ORDER BY
				h.history_date
	</select>

	<select id="selectPhysicalOrder" resultMap="orderMap" parameterType="int">
		SELECT
			m.mem_no
			, m.mem_name
			, m.mem_age
			, m.mem_gender
			, o.order_no
			, o.order_code
			, o.body_code
			, o.chart_no
			, o.emp_no
			, ch.chart_date
			, ch.chart_record
		FROM
			member m
			, patient p
			, chart ch
			, "ORDER" o
			, "RECEIPT" r
			, emp e
		WHERE
			( o.order_code = 'OD003'
				OR o.order_code = 'OD008'
				OR o.order_code = 'OD009' )
			AND o.chart_no = ch.chart_no
			AND ch.receipt_no = r.receipt_no
			AND o.emp_no = r.emp_no
			AND o.emp_no = e.emp_no
			AND p.patnt_no = ch.patnt_no
			AND p.patnt_no = r.patnt_no
			AND p.mem_no = m.mem_no
			and m.mem_no = #{memNo}
	</select>
</mapper>