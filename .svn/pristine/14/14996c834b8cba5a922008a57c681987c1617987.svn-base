<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.IMainAdminMapper">
	
	
	<!-- <insert id="enrollMember" parameterType="memberVO" >
		insert into member(
		mem_no, mem_id, mem_pw, mem_name, mem_age, mem_gender,mem_regno1, mem_regno2,
		mem_tel,mem_address1, mem_address2, mem_signup_date,mem_type,mem_social
		)
		values(
		member_seq.nextval, #{memRegno},#{memRegno1},#{memName},#{memAge},#{memGender},#{memRegno1},#{memRegno2},
		#{memTel},#{memAddress1},#{memAddress2},SYSDATE,'MT002','N'
		)
		
	</insert> -->
	
	<insert id="enrollMember" parameterType="memberVO" useGeneratedKeys="true" >
	    <!-- keyProperty에 설정된 프로퍼티에 자동 생성된 키가 할당됨 -->
	    <selectKey keyProperty="memNo" resultType="memberVO" order="BEFORE">
	        SELECT member_seq.nextval as mem_no FROM dual
	        <!-- 새로 삽입된 레코드의 키 값을 가져옴 -->
	    </selectKey>
	    <!-- useGeneratedKeys 속성을 true로 설정하여 자동 생성된 키를 가져옴 -->
	    <!-- keyProperty는 자동 생성된 키가 설정될 객체의 프로퍼티를 나타냄 -->
	    insert into member(
			mem_no, mem_id, mem_pw, mem_name, mem_age, mem_gender,mem_regno1, mem_regno2,
			mem_tel,mem_address1, mem_address2, mem_signup_date,mem_type,mem_social
		)
		values(
			#{memNo}, #{memRegno},#{memRegno1},#{memName},#{memAge},#{memGender},#{memRegno1},#{memRegno2},
			#{memTel},#{memAddress1},#{memAddress2},SYSDATE,'MT002','N'
		)
		
	</insert>
	
	
	<insert id="enrollPatient" parameterType="memberVO" useGeneratedKeys="true" >
		<selectKey keyProperty="patntNo" resultType="memberVO" order="BEFORE">
			select patient_seq.nextval as patnt_no from dual
		</selectKey>
		
		insert into patient(
			patnt_no, mem_no
		)
		values(
			#{patntNo},#{memNo}
		)
	
	</insert>
	
	<select id="findReceiptDoctor" resultType="memberVO">
		select mem_name from member
		    where mem_no in 
		       ( select mem_no from emp
		        where emp_no in 
		            (select emp_no from clinic
		            where clinic_status != 'CS003' ))
	</select>
</mapper>